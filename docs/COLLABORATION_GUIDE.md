# 妖精カフェ物語 - 共同開発ガイド

複数のAI（または人間）で同じリポジトリを共有して並行開発するためのガイドラインです。

---

## 目次

1. [基本方針](#1-基本方針)
2. [作業領域の分担](#2-作業領域の分担)
3. [ブランチ戦略](#3-ブランチ戦略)
4. [コンフリクト回避ルール](#4-コンフリクト回避ルール)
5. [統合フロー](#5-統合フロー)
6. [具体的なタスク分担例](#6-具体的なタスク分担例)
7. [コミュニケーション規約](#7-コミュニケーション規約)

---

## 1. 基本方針

### 1-1. 衝突を避ける設計

```
┌─────────────────────────────────────────────────────────┐
│  原則: 1つのファイルは1人（1AI）が担当                   │
│  ────────────────────────────────────────────────────── │
│  ・同じファイルを複数人が同時編集しない                 │
│  ・担当領域（ディレクトリ/ファイル）を明確に分ける      │
│  ・共有インターフェース（型定義）は先に固める           │
└─────────────────────────────────────────────────────────┘
```

### 1-2. 依存関係の方向

```
        ┌──────────────┐
        │  types/      │  ← 最初に固める（共有契約）
        └──────┬───────┘
               │
    ┌──────────┼──────────┐
    │          │          │
    ▼          ▼          ▼
┌───────┐ ┌───────┐ ┌───────┐
│ data/ │ │store/ │ │assets/│  ← 並行作業可能
└───┬───┘ └───┬───┘ └───────┘
    │         │
    └────┬────┘
         │
         ▼
    ┌─────────┐
    │components│  ← data/store に依存
    └─────────┘
```

---

## 2. 作業領域の分担

### 2-1. 独立性の高い領域（並行作業しやすい）

| 領域 | 担当候補 | 依存関係 |
|------|----------|---------|
| **シナリオ/イベントデータ** | AI-A | types のみ |
| **UIコンポーネント** | AI-B | types, store |
| **アセット準備** | 人間 | なし |
| **音声/BGM** | 人間 | なし |

### 2-2. 推奨分担パターン

```
┌─────────────────────────────────────────────────────────────┐
│  パターン A: 「データ担当」と「UI担当」で分ける             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【AI-A: データ・ロジック担当】                             │
│   ├── src/data/events/*.ts    (イベントデータ)              │
│   ├── src/data/characters/*.ts (キャラ追加データ)           │
│   ├── src/store/*Store.ts     (状態管理の拡張)              │
│   └── src/hooks/*.ts          (ビジネスロジック)            │
│                                                             │
│  【AI-B: UI・表示担当】                                     │
│   ├── src/components/scenario/* (シナリオ再生UI)            │
│   ├── src/components/gallery/*  (ギャラリーUI)              │
│   ├── src/components/character/*(キャラ詳細UI)              │
│   └── src/components/common/*   (共通UI改善)                │
│                                                             │
│  【人間: アセット担当】                                     │
│   ├── public/assets/images/*   (画像ファイル)               │
│   └── public/assets/audio/*    (音声ファイル)               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

```
┌─────────────────────────────────────────────────────────────┐
│  パターン B: 「キャラ単位」で分ける                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【AI-A: ルシア・カゲロウ・ハルト・レン・ミズキ】           │
│   └── 5キャラ分のイベント・CG・立ち絵指定                   │
│                                                             │
│  【AI-B: ソウマ・ユキト・リク・アオイ・シオン】             │
│   └── 5キャラ分のイベント・CG・立ち絵指定                   │
│                                                             │
│  【共通作業（どちらか or 調整役）】                         │
│   ├── ScenarioScreen などの共通UI                           │
│   └── 型定義の拡張                                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. ブランチ戦略

### 3-1. 推奨ブランチ構成

```
main
 │
 ├── develop                    ← 統合ブランチ
 │    │
 │    ├── feature/scenario-ui   ← AI-A の作業ブランチ
 │    │
 │    ├── feature/event-data    ← AI-B の作業ブランチ
 │    │
 │    └── feature/assets        ← 人間の作業ブランチ
 │
 └── release/v1.0               ← リリース準備
```

### 3-2. ブランチ命名規則

| 種類 | フォーマット | 例 |
|------|-------------|-----|
| 機能追加 | `feature/{機能名}` | `feature/scenario-ui` |
| バグ修正 | `fix/{内容}` | `fix/save-load-bug` |
| キャラ単位 | `feature/{キャラ名}-events` | `feature/lucia-events` |
| AI識別 | `claude/{タスク}-{ID}` | `claude/add-gallery-XyZ12` |

### 3-3. マージルール

```
1. 作業完了 → develop へ PR
2. コンフリクトがあれば担当者が解消
3. レビュー（人間 or 別AI）後にマージ
4. 定期的に develop → main へマージ
```

---

## 4. コンフリクト回避ルール

### 4-1. 絶対に守るルール

| ルール | 理由 |
|--------|------|
| **types/index.ts は追記のみ** | 既存の型を変更すると全体に影響 |
| **index.ts（エクスポート）は最後に編集** | 各自の作業完了後に統合 |
| **同じコンポーネントを同時編集しない** | マージ困難 |
| **新規ファイルは事前に宣言** | 同名ファイル作成を防ぐ |

### 4-2. ファイル担当の宣言方法

作業開始時に `docs/TASK_ASSIGNMENTS.md` に記録:

```markdown
## 現在の担当状況

| ファイル/ディレクトリ | 担当 | 期間 | 状態 |
|----------------------|------|------|------|
| src/components/scenario/* | AI-A | 2/10-2/12 | 作業中 |
| src/data/events/lucia.ts | AI-B | 2/10-2/11 | 作業中 |
| public/assets/images/lucia/* | 人間 | 2/10- | 作業中 |
```

### 4-3. 共有ファイルの編集手順

`types/index.ts` や `App.tsx` など複数人が触る可能性のあるファイル:

```
1. 編集前に最新を pull
2. 変更は「追記」のみ（既存コードを変更しない）
3. 編集後すぐに commit & push
4. Slack/Issue で「○○を追記しました」と通知
```

---

## 5. 統合フロー

### 5-1. 日次の統合サイクル

```
┌─────────────────────────────────────────────────────────┐
│  朝                                                     │
│  ├─ develop から最新を pull                             │
│  └─ 担当ファイルを TASK_ASSIGNMENTS.md に記録           │
├─────────────────────────────────────────────────────────┤
│  作業中                                                 │
│  ├─ 自分のブランチで作業                                │
│  ├─ こまめに commit（1機能 = 1コミット）                │
│  └─ 共有ファイル編集時は即 push + 通知                  │
├─────────────────────────────────────────────────────────┤
│  夕方                                                   │
│  ├─ develop へ PR 作成                                  │
│  ├─ コンフリクトがあれば解消                            │
│  └─ レビュー後マージ                                    │
└─────────────────────────────────────────────────────────┘
```

### 5-2. 統合時のチェックリスト

- [ ] `npm run type-check` が通る
- [ ] `npm run lint` が通る
- [ ] `npm run dev` で起動確認
- [ ] 新規追加した画面への導線がある
- [ ] 新規追加したデータが正しく読み込まれる

---

## 6. 具体的なタスク分担例

### 6-1. 2AI + 人間 での分担例

```
┌─────────────────────────────────────────────────────────────┐
│  Week 1: 基盤作業                                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【AI-A】シナリオUI基盤                                     │
│   Day 1-2: ScenarioScreen, DialogueBox 実装                 │
│   Day 3-4: CharacterLayer, BackgroundLayer 実装             │
│   Day 5: ChoiceList, テスト                                 │
│                                                             │
│  【AI-B】イベントデータ拡充                                 │
│   Day 1: レン (ren) のイベント2本                           │
│   Day 2: ミズキ (mizuki) のイベント2本                      │
│   Day 3: ソウマ (soma) のイベント2本                        │
│   Day 4: ユキト (yukito) のイベント2本                      │
│   Day 5: データ整合性チェック                               │
│                                                             │
│  【人間】アセット準備                                       │
│   並行: プレースホルダー画像作成                            │
│   並行: 主要キャラ立ち絵発注/作成                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Week 2: コンテンツ拡充                                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【AI-A】追加UI                                             │
│   Day 1-2: GalleryScreen 実装                               │
│   Day 3-4: IkemenDetailScreen 実装                          │
│   Day 5: 画面遷移統合                                       │
│                                                             │
│  【AI-B】残りイベント                                       │
│   Day 1: リク (riku) のイベント2本                          │
│   Day 2: アオイ (aoi) のイベント2本                         │
│   Day 3: シオン (shion) のイベント2本                       │
│   Day 4-5: 全イベント動作確認                               │
│                                                             │
│  【人間】アセット配置                                       │
│   並行: 完成した画像を配置                                  │
│   並行: BGM/SE 準備                                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6-2. ファイル単位の担当マッピング

```
src/
├── components/
│   ├── scenario/          ← 【AI-A 専任】
│   │   ├── ScenarioScreen.tsx
│   │   ├── DialogueBox.tsx
│   │   ├── CharacterLayer.tsx
│   │   ├── BackgroundLayer.tsx
│   │   ├── ChoiceList.tsx
│   │   └── index.ts
│   │
│   ├── gallery/           ← 【AI-A 専任】
│   │   ├── GalleryScreen.tsx
│   │   ├── CGViewer.tsx
│   │   └── index.ts
│   │
│   ├── common/            ← 【共有: 追記のみ】
│   └── management/        ← 【既存: 変更時は相談】
│
├── data/
│   ├── events/            ← 【AI-B 専任】
│   │   ├── lucia.ts       (既存確認)
│   │   ├── kagerou.ts     (既存確認)
│   │   ├── haruto.ts      (既存確認)
│   │   ├── ren.ts         (新規)
│   │   ├── mizuki.ts      (新規)
│   │   ├── soma.ts        (新規)
│   │   ├── yukito.ts      (新規)
│   │   ├── riku.ts        (新規)
│   │   ├── aoi.ts         (新規)
│   │   ├── shion.ts       (新規)
│   │   └── index.ts       (統合時に編集)
│   │
│   └── *.ts               ← 【共有: 変更時は相談】
│
├── store/                 ← 【共有: 拡張時は相談】
├── types/                 ← 【共有: 追記のみ】
└── hooks/                 ← 【必要に応じて分担】

public/assets/             ← 【人間 専任】
```

---

## 7. コミュニケーション規約

### 7-1. 作業開始時

```markdown
## 作業開始報告

**担当者:** AI-A
**ブランチ:** feature/scenario-ui
**作業ファイル:**
- src/components/scenario/ScenarioScreen.tsx (新規)
- src/components/scenario/DialogueBox.tsx (新規)

**依存:**
- types/index.ts の EventScene 型を使用
- eventStore の currentEvent を参照

**予定完了:** 2/12
```

### 7-2. 型追加時

```markdown
## 型追加通知

**ファイル:** src/types/index.ts
**追加内容:**
```typescript
// シナリオ再生状態
export interface ScenarioState {
  currentSceneIndex: number;
  isPlaying: boolean;
  selectedChoiceId?: string;
}
```

**影響範囲:** scenario 関連コンポーネントで使用予定
```

### 7-3. 統合依頼時

```markdown
## PR 作成通知

**PR:** #15 Add scenario playback UI
**ブランチ:** feature/scenario-ui → develop
**変更概要:**
- ScenarioScreen 新規追加
- App.tsx に画面追加（1行のみ）

**確認事項:**
- [ ] types の変更なし
- [ ] 既存コンポーネントへの影響なし
- [x] App.tsx への追記あり（要確認）
```

---

## 付録: クイック判断フローチャート

```
作業を始める前に:

  このファイルは誰かが担当中？
        │
        ├─ はい → 別のタスクを選ぶ or 相談
        │
        └─ いいえ → TASK_ASSIGNMENTS.md に記録して作業開始
                    │
                    ├─ 新規ファイル作成？ → そのまま進める
                    │
                    └─ 既存ファイル編集？
                            │
                            ├─ types/index.ts → 追記のみ、即push
                            │
                            ├─ App.tsx → 追記のみ、即push
                            │
                            └─ その他 → 担当確認してから編集
```

---

## 次のアクション

1. **TASK_ASSIGNMENTS.md を作成** - 担当状況を記録開始
2. **各担当者のブランチを作成** - feature/* で作業開始
3. **最初のタスクを割り当て** - 上記の分担例を参考に
